# BenderVectorControl
New manual & autonomous control law for bender using vector addition

#ROS folder: All the files needed to run the ROS graph for manual control are located in this folder. The graph is designed to have 3 running nodes, with an optional compass node. See the rosgraph.png file in the ROS folder for node and topic names. 
The first is the joy_node. This is essentially a driver for all general logitech/xbox/playstation controllers: http://wiki.ros.org/joy. 
The second can be one of four: VectorCalcSingleStick_node or VectorCalcDualStick_node or VectorCalcTriStick_node or VectorCalcSteeringWheel_node. They are just for different joystick types. The most stable & reccomended is the VecorCalcDualStick_node, this one runs the logitech handheld controller. This just parses the relevant data we get from joy_node and publishes a Vector3 msg type of [speed,translation_vector,rotation_vector]. See
The third is TeensyWrite_node. This is the node where all the math from the Vector Steering Writeup is implemented. Once the calculations are performed serial data is written as a newline string to each of the wheel assemblies containting the desired bearing and speed. TeensyWrite_node also has logging functionality, and several odometry filters to remove noise generated by abrupt turning. For mapping with the IGVC2019 a tf.broadcaster from the ROS tf package was also included that breaks down Bender's X,Y translation in meters and orientation from compass data. The idea will be to replace what was Control_node from the IGVC2018 repo with the improved TeensyWrite_node.  


#TeensyWrite folder: This folder contains all the c++ code running on the Teensy for manual control
This code is mostly identical to what runs during autonomous navigation. The only difference is in the PID gains and the data that the Teensy echos back to the TeensyWrite_node for wheel wraparound control, odometry, and logging. For the VectorCalcSteeringWheel_node there is also the arduino code that the dial runs. 

#logged data folder: This just contains a host of raw .csv files with logged data concerning benders drivetrain functionality. Odometry propagation filter .csv's are in logged_data/propagation

Notes for using Teensy3.6 (differs slightly from Arduino boards)
-Upload teensy code from Arduino IDE (ensure that the "port" option under "tools" matches the Teensy USB address)
-If you haven't already get the Teensyduino addon software https://www.pjrc.com/teensy/td_download.html
-Finally run the python script from a terminal, and THEN power on bender. You must do it in this order. If the hub motors are not being written a PWM when the MCs are powered on the hub motors may not all turn.
